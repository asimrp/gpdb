<span id="title-text"> Storage & Access : How to run upgrade TINC test locally </span>
======================================================================================

This page last changed on Aug 14, 2013 by hharada.

TINC has upgrade test cases.  The location to look at is $TINCREPO/mpp/gpdb/tests/utilities/upgrade. \_\_init\_\_.py defines UpgradeTestCase and test\_upgrade.py contains basic testing.  You can extend UpgradeTestCase for your purpose.

UpgradeTestCase has some connection with pulse.  In fact, it defines the target pulse URL to download binaries.  This would work well in pulse environment, but not in local development.  UpgradeTestCase provides a way to run upgrade test locally, though.  The basic idea is implemented in test\_upgrade.py.

``` theme:
    @unittest.skipIf('BLDWRAP_TOP' in os.environ,
                     'skip in pulse(BLDWRAP_TOP is set)') 
    def test_upgrade_42_43_existing_binaries(self):
        """
        @gpdb_version (4.2.99.99, main]
        """
```

This will use existing binary for upgrade tests instead of downloading pulse build. The following are how to run this.

-   Set up normal TINC environment, e.g. TINCHOME and source tincrepo\_env.sh
-   Go to working directory

    ``` theme:
    $ cd mpp/gpdb/tests/utilities
    ```

-   Create binary directories for both older and newer

    ``` theme:
    $ ln -s /data/greenplum-db-REL4_2 upgrade/gpdb_4.2.2.4
    $ ln -s /data/greenplum-db-repl upgrade/gpdb_4.3_MAIN
    ```

    The minor version does not matter.  Create exact same name.

-   Run tinc

    ``` theme:
    $ tinc.py mpp.gpdb.tests.utilities.test_upgrade.test_upgrade.test_upgrade_42_43_existing_binaries
    ```

-   After the test, it always delete the binaries.  If you have created symbolic links for them, re-create them when you kick it off again
-   it creates data directories under the older binary directory.  In this case,

    ``` theme:
    /data/greenplum-db-REL4_2/master
    /data/greenplum-db-REL4_2/primary
    /data/greenplum-db-REL4_2/mirror
    ```

    Make sure delete them entirely before kicking off the test.  UpgradeTestCase initializes database every time using gpinitsystem.

 

Document generated by Confluence on May 17, 2016 19:14


