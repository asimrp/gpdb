<span id="title-text"> Storage & Access : Create a code coverage pulse project </span>
======================================================================================

This page last changed on Jul 23, 2014 by deyg.

Currently GPDB CI environment uses gcov to see the code coverage.  The report is generated by lcov.

-   <a href="http://gcc.gnu.org/onlinedocs/gcc/Gcov.md" class="external-link">Gcov</a>
-   <a href="http://ltp.sourceforge.net/coverage/lcov.php" class="external-link">Lcov</a>

GPDB Makefile is already aware of building with those options.  All you have to do is to pass them to top-level make.

    $ make CUSTOM_COPT='-fprofile-arcs -ftest-coverage'"

### Create a build project

This option is automatically passed by releng script (//releng/bld/main/bin/build-gpdb.sh) that is kicked off by pulse.  To use it, set BUILD\_TYPE property to gcov.  It is recommended to add "-instrument" to the build pulse project name (ex.: GPDB-431-QP-TINC-CARDINALITY-CodeCoverage-instrument) as it is referred by another releng script (//releng/bld/main/bin/sys\_mgmt\_utils.sh) later.

Then add more artifacts.  Go to "recipes, commands and artifacts" -&gt; "Build & Installcheck" -&gt; "Installcheck" -&gt; artifacts.  Add "lcov-INSTALLCHECKGOOD-report" as a directory artifact.

-   base directory: src/lcov-INSTALLCHECKGOOD-report
-   featured: checked
-   publish: checked

You may want to do the same for Unittest.

### Run code coverage in another test project

To generate .gcda files (generated by gcov build binary), you need to have exact same path with build object files (.gcno etc).  There are two environment variables to change this fixed path, GCOV\_PREFIX and GCOV\_PREFIX\_STRIP.  Refer to gcov's page for further information on them.  Our test projects are already aware of it, so it's easy.  Add two more artifacts to the build project, both of which are file artifacts &lt;WHERE???&gt;.

-   name: gcov-cdb-pg.tgz
-   file: src/gcov-cdb-pg.tgz
-   publish: checked

and

-   name: gcov-gpperfmon.tgz
-   file: src/gcov-gpperfmon.tgz
-   publish: checked

Then create (or clone) your test project, and change properties to reference this build.  Add a directory artifact.

-   name: lcov-test-report
-   file: product/greenplum-db/lcov-test-report
-   featured: checked
-   publish: checked

That's all.

 

See also:

[Running GPDB Code Coverage from Pulse](https://confluence.eng.pivotal.io/display/ECHO/Running+GPDB+Code+Coverage+from+Pulse)

[Pulse KB\#HowtoRunCodecoveragethroughPulse](https://confluence.eng.pivotal.io/display/QA/Pulse+KB#PulseKB-HowtoRunCodecoveragethroughPulse)

Document generated by Confluence on May 17, 2016 19:14


